{% extends 'web/base.html' %}

{% block title %}
  Датасеты
{% endblock %}

{% block header %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
{% endblock %}

{% block content %}
  <div class="container pt-3">
  <a role="button" href="{% url 'datasets_new' %}" class="mb-3 mt-3 btn btn-outline-primary"><i class="bi bi-plus-lg"></i></a>
    {% include 'web/includes/search_form.html' %}
    <table class="table table-striped">
      <thead>
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Автор</th>
        <th scope="col">Описание</th>
        <th scope="col">Публичный</th>
        <th scope="col">Создан</th>
        <th scope="col">Обновлен</th>
        <th scope="col">Действие</th>
      </tr>
      </thead>
      <tbody>
      {% if datasets %}
        {% for row in datasets %}
          <tr>
            <th scope="row">{{ row.id }}</th>
            <td>{{ row.author.email }}</td>
            {% if row.description %}
              {% if row.description|length > 25 %}
                <td data-bs-toggle="tooltip" data-bs-placement="right"
                    data-bs-title="{{ row.description|truncatechars:"100"|default:"-" }}">{{ row.description|truncatechars:"25"|default:"-" }}</td>
              {% else %}
                <td>{{ row.description }}</td>
              {% endif %}
            {% else %}
              <td>-</td>
            {% endif %}
            <td>{% if row.is_public %}<i class="bi bi-check-circle-fill link-success"></i>{% else %}
              <i class="bi bi-x-circle link-danger"></i>{% endif %}</td>
            <td>{{ row.dt_created|date:"d/m/Y G:i:s" }}</td>
            <td>{{ row.dt_edited|date:"d/m/Y G:i:s" }}</td>
            <td>
              <div class="dropdown-center">
                <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                  Действие
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item disabled" href="#">Скачать</a></li>
                  {% if request.user.is_authenticated and row.author == request.user %}
                    <li>
                      <a class="dropdown-item" href="{% url 'datasets_edit' pk=row.pk %}">Редактировать</a>
                    </li>
                    <li>
                      <button class="dropdown-item link-danger" onclick="openModalDelete({{ row.pk }})">Удалить</button>
                    </li>
                  {% endif %}
                </ul>
              </div>
            </td>
          </tr>
        {% endfor %}
      {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}